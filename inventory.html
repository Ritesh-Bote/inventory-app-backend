<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .card .value {
            font-size: 2em;
            font-weight: bold;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .form-section h2 {
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
        }

        input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
        }

        .btn:hover {
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        tbody tr:hover {
            background-color: #f5f5f5;
        }

        .low-stock {
            background-color: #ffebee !important;
        }

        .stock-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-ok {
            background-color: #c8e6c9;
            color: #2e7d32;
        }

        .status-low {
            background-color: #ffcdd2;
            color: #c62828;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .sell-btn {
            background: #4caf50;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .sell-btn:hover {
            background: #45a049;
        }

        .delete-btn {
            background: #f44336;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        .download-btn {
            background: #ff9800;
            margin-top: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }

        .modal h3 {
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
        }

        .cancel-btn {
            background: #999;
        }

        .test-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .test-section h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .success-msg {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¶ Inventory Management System</h1>

        <!-- Test Section -->
        <div class="test-section">
            <h3>üîß System Check</h3>
            <p>Status: <span id="systemStatus" style="font-weight: bold;">Checking...</span></p>
            <p>Products in Storage: <span id="storageCount" style="font-weight: bold;">0</span></p>
            <button class="btn" onclick="testSystem()" style="background: #ffc107; color: #000; margin-top: 10px;">
                üîç Test System
            </button>
            <div id="successMsg" class="success-msg"></div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="card">
                <h3>Total Products</h3>
                <div class="value" id="totalProducts">0</div>
            </div>
            <div class="card">
                <h3>Total Profit</h3>
                <div class="value" id="totalProfit">‚Çπ0</div>
            </div>
            <div class="card">
                <h3>Low Stock Items</h3>
                <div class="value" id="lowStockCount">0</div>
            </div>
            <div class="card">
                <h3>Total Revenue</h3>
                <div class="value" id="totalRevenue">‚Çπ0</div>
            </div>
        </div>

        <!-- Add Product Form -->
        <div class="form-section">
            <h2>‚ûï Add New Product</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Item Name*</label>
                    <input type="text" id="itemName" placeholder="e.g., Rice, Soap">
                </div>
                <div class="form-group">
                    <label>Quantity*</label>
                    <input type="number" id="quantity" placeholder="e.g., 10" min="0">
                </div>
                <div class="form-group">
                    <label>Purchase Price (‚Çπ)*</label>
                    <input type="number" id="purchasePrice" placeholder="e.g., 50" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Selling Price (‚Çπ)*</label>
                    <input type="number" id="sellingPrice" placeholder="e.g., 75" min="0" step="0.01">
                </div>
            </div>
            <button class="btn" onclick="addProduct()">‚ûï Add Product</button>
        </div>

        <!-- Products Table -->
        <div>
            <h2>üìã Product Inventory</h2>
            <table>
                <thead>
                    <tr>
                        <th>Item Name</th>
                        <th>Quantity</th>
                        <th>Purchase Price</th>
                        <th>Selling Price</th>
                        <th>Profit/Unit</th>
                        <th>Stock Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productTable">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            No products yet. Add your first product above!
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <button class="btn download-btn" onclick="downloadCSV()">üì• Download Report (CSV)</button>
    </div>

    <!-- Sell Modal -->
    <div id="sellModal" class="modal">
        <div class="modal-content">
            <h3>üõí Sell Product</h3>
            <div class="form-group">
                <label id="sellProductName" style="font-size: 1.1em; color: #333; margin-bottom: 15px;"></label>
                <label>Quantity to Sell:</label>
                <input type="number" id="sellQuantity" min="1" placeholder="Enter quantity">
            </div>
            <div class="modal-buttons">
                <button class="btn cancel-btn" onclick="closeSellModal()">Cancel</button>
                <button class="btn sell-btn" onclick="confirmSell()">Confirm Sale</button>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // GLOBAL VARIABLES
        // ==============================================
        let products = [];
        let totalRevenue = 0;
        let currentSellProductId = null;

        // ==============================================
        // LOCALSTORAGE FUNCTIONS
        // ==============================================
        
        function saveToLocalStorage() {
            try {
                localStorage.setItem('inventoryProducts', JSON.stringify(products));
                localStorage.setItem('inventoryRevenue', totalRevenue.toString());
                console.log('‚úÖ Data saved to localStorage');
                updateStorageCount();
                return true;
            } catch (error) {
                console.error('‚ùå Error saving to localStorage:', error);
                alert('Error saving data: ' + error.message);
                return false;
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedProducts = localStorage.getItem('inventoryProducts');
                const savedRevenue = localStorage.getItem('inventoryRevenue');
                
                if (savedProducts) {
                    products = JSON.parse(savedProducts);
                    console.log('‚úÖ Loaded products:', products);
                }
                
                if (savedRevenue) {
                    totalRevenue = parseFloat(savedRevenue);
                    console.log('‚úÖ Loaded revenue:', totalRevenue);
                }
                
                updateStorageCount();
                return true;
            } catch (error) {
                console.error('‚ùå Error loading from localStorage:', error);
                return false;
            }
        }

        function updateStorageCount() {
            const count = products.length;
            document.getElementById('storageCount').textContent = count;
        }

        // ==============================================
        // SYSTEM TEST FUNCTION
        // ==============================================
        
        function testSystem() {
            const msg = document.getElementById('successMsg');
            msg.style.display = 'block';
            msg.innerHTML = 'üîÑ Running system test...';
            
            setTimeout(() => {
                const hasLocalStorage = typeof(Storage) !== "undefined";
                const productCount = products.length;
                
                let status = '';
                status += '‚úÖ LocalStorage: ' + (hasLocalStorage ? 'Available' : 'Not Available') + '<br>';
                status += '‚úÖ Products Loaded: ' + productCount + '<br>';
                status += '‚úÖ System: Working Properly<br>';
                status += '<br><strong>Try adding a product now!</strong>';
                
                msg.innerHTML = status;
                document.getElementById('systemStatus').textContent = '‚úÖ Working';
                document.getElementById('systemStatus').style.color = 'green';
            }, 500);
        }

        // ==============================================
        // ADD PRODUCT FUNCTION
        // ==============================================
        
        function addProduct() {
            console.log('üîµ Add Product button clicked');
            
            const itemName = document.getElementById('itemName').value.trim();
            const quantity = document.getElementById('quantity').value;
            const purchasePrice = document.getElementById('purchasePrice').value;
            const sellingPrice = document.getElementById('sellingPrice').value;

            console.log('Form Data:', { itemName, quantity, purchasePrice, sellingPrice });

            // Validation
            if (!itemName) {
                alert('‚ö†Ô∏è Please enter item name!');
                return;
            }
            if (!quantity) {
                alert('‚ö†Ô∏è Please enter quantity!');
                return;
            }
            if (!purchasePrice) {
                alert('‚ö†Ô∏è Please enter purchase price!');
                return;
            }
            if (!sellingPrice) {
                alert('‚ö†Ô∏è Please enter selling price!');
                return;
            }

            const qty = parseInt(quantity);
            const pPrice = parseFloat(purchasePrice);
            const sPrice = parseFloat(sellingPrice);

            if (qty < 0 || pPrice < 0 || sPrice < 0) {
                alert('‚ö†Ô∏è Please enter positive numbers!');
                return;
            }

            // Create product object
            const product = {
                id: Date.now(),
                name: itemName,
                quantity: qty,
                purchasePrice: pPrice,
                sellingPrice: sPrice,
                soldQuantity: 0
            };

            console.log('‚úÖ Product created:', product);

            // Add to array
            products.push(product);
            console.log('‚úÖ Products array:', products);

            // Save to localStorage
            saveToLocalStorage();

            // Clear form
            document.getElementById('itemName').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('purchasePrice').value = '';
            document.getElementById('sellingPrice').value = '';

            // Update display
            displayProducts();
            updateDashboard();
            
            alert('‚úÖ Product "' + product.name + '" added successfully!');
        }

        // ==============================================
        // DISPLAY PRODUCTS FUNCTION
        // ==============================================
        
        function displayProducts() {
            console.log('üîµ Displaying products. Count:', products.length);
            
            const tbody = document.getElementById('productTable');
            tbody.innerHTML = '';

            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            No products yet. Add your first product above!
                        </td>
                    </tr>
                `;
                return;
            }

            products.forEach((product, index) => {
                console.log(`Rendering product ${index}:`, product);
                
                const profit = product.sellingPrice - product.purchasePrice;
                const isLow = product.quantity < 5;
                
                const row = tbody.insertRow();
                if (isLow) {
                    row.className = 'low-stock';
                }
                
                row.innerHTML = `
                    <td><strong>${product.name}</strong></td>
                    <td><strong>${product.quantity}</strong></td>
                    <td>‚Çπ${product.purchasePrice.toFixed(2)}</td>
                    <td>‚Çπ${product.sellingPrice.toFixed(2)}</td>
                    <td style="color: ${profit >= 0 ? 'green' : 'red'}; font-weight: 600;">
                        ‚Çπ${profit.toFixed(2)}
                    </td>
                    <td>
                        <span class="stock-status ${isLow ? 'status-low' : 'status-ok'}">
                            ${isLow ? '‚ö†Ô∏è Low Stock' : '‚úÖ In Stock'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="sell-btn" onclick="openSellModal(${product.id})" ${product.quantity === 0 ? 'disabled' : ''}>
                                üõí Sell
                            </button>
                            <button class="delete-btn" onclick="deleteProduct(${product.id})">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </td>
                `;
            });

            console.log('‚úÖ All products rendered');
        }

        // ==============================================
        // UPDATE DASHBOARD FUNCTION
        // ==============================================
        
        function updateDashboard() {
            const totalProducts = products.length;

            let totalProfit = 0;
            products.forEach(product => {
                const profitPerUnit = product.sellingPrice - product.purchasePrice;
                const soldQty = product.soldQuantity || 0;
                totalProfit += profitPerUnit * soldQty;
            });

            const lowStockCount = products.filter(p => p.quantity < 5).length;

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalProfit').textContent = '‚Çπ' + totalProfit.toFixed(2);
            document.getElementById('lowStockCount').textContent = lowStockCount;
            document.getElementById('totalRevenue').textContent = '‚Çπ' + totalRevenue.toFixed(2);
        }

        // ==============================================
        // DELETE PRODUCT FUNCTION
        // ==============================================
        
        function deleteProduct(id) {
            if (confirm('‚ùì Are you sure you want to delete this product?')) {
                products = products.filter(product => product.id !== id);
                saveToLocalStorage();
                displayProducts();
                updateDashboard();
                alert('‚úÖ Product deleted successfully!');
            }
        }

        // ==============================================
        // SELL PRODUCT FUNCTIONS
        // ==============================================
        
        function openSellModal(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;

            if (product.quantity === 0) {
                alert('‚ö†Ô∏è Out of stock! Cannot sell this product.');
                return;
            }

            currentSellProductId = id;
            document.getElementById('sellProductName').textContent = `Product: ${product.name} (Available: ${product.quantity})`;
            document.getElementById('sellQuantity').value = '';
            document.getElementById('sellQuantity').max = product.quantity;
            document.getElementById('sellModal').style.display = 'block';
        }

        function closeSellModal() {
            document.getElementById('sellModal').style.display = 'none';
            currentSellProductId = null;
        }

        function confirmSell() {
            const sellQty = parseInt(document.getElementById('sellQuantity').value);
            
            if (!sellQty || sellQty <= 0) {
                alert('‚ö†Ô∏è Please enter a valid quantity!');
                return;
            }

            const product = products.find(p => p.id === currentSellProductId);
            
            if (!product) {
                alert('‚ö†Ô∏è Product not found!');
                closeSellModal();
                return;
            }

            if (sellQty > product.quantity) {
                alert(`‚ö†Ô∏è Not enough stock! Only ${product.quantity} available.`);
                return;
            }

            product.quantity -= sellQty;
            product.soldQuantity = (product.soldQuantity || 0) + sellQty;
            
            const revenue = sellQty * product.sellingPrice;
            totalRevenue += revenue;

            saveToLocalStorage();
            closeSellModal();
            displayProducts();
            updateDashboard();
            
            alert(`‚úÖ Sold ${sellQty} unit(s) of ${product.name}\nüí∞ Revenue: ‚Çπ${revenue.toFixed(2)}`);
        }

        // ==============================================
        // DOWNLOAD CSV FUNCTION
        // ==============================================
        
        function downloadCSV() {
            if (products.length === 0) {
                alert('‚ö†Ô∏è No products to download!');
                return;
            }

            let csv = 'Item Name,Current Quantity,Sold Quantity,Purchase Price,Selling Price,Profit per Unit,Stock Status\n';

            products.forEach(product => {
                const profitPerUnit = product.sellingPrice - product.purchasePrice;
                const stockStatus = product.quantity < 5 ? 'Low Stock' : 'In Stock';
                const soldQty = product.soldQuantity || 0;

                csv += `"${product.name}",${product.quantity},${soldQty},${product.purchasePrice.toFixed(2)},${product.sellingPrice.toFixed(2)},${profitPerUnit.toFixed(2)},${stockStatus}\n`;
            });

            csv += `\nSummary\n`;
            csv += `Total Products,${products.length}\n`;
            csv += `Total Revenue,${totalRevenue.toFixed(2)}\n`;

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.href = url;
            link.download = 'inventory_report_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ CSV report downloaded successfully!');
        }

        // ==============================================
        // MODAL CLOSE ON OUTSIDE CLICK
        // ==============================================
        
        window.onclick = function(event) {
            const modal = document.getElementById('sellModal');
            if (event.target === modal) {
                closeSellModal();
            }
        }

        // ==============================================
        // INITIALIZE ON PAGE LOAD
        // ==============================================
        
        window.onload = function() {
            console.log('üîµ Page loaded. Initializing...');
            
            loadFromLocalStorage();
            displayProducts();
            updateDashboard();
            
            document.getElementById('systemStatus').textContent = '‚úÖ Ready';
            document.getElementById('systemStatus').style.color = 'green';
            
            console.log('‚úÖ Initialization complete');
        };
    </script>
</body>
</html>